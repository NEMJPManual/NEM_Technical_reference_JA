## NCDawareRank

ノードがネットワーク内でどれほど突出しているかを定義する方法にはいくつかあります。PageRankはその一つです。

NCDawareRankはエルゴード的マルコフ連鎖の定常確率分布が計算される[^9](/References.md#9),[^11](/References.md#11)という点ではPageRankに似ていますが、スケールの大きいグラフ（情報の流れを表す）のレベル間近似度行列(inter-level proximity matrix)$$M$$を追加で導入する点に違いがあります。
この行列は、同グループ内に所属するノードはお互いにリンクを張り合っておりより密なクラスタを作っているという事実をモデル化したものです。
これにより、NCDawareRankは計算がPageRankより早く収束するようになります。
さらに、同レベルに属するノードのランクに制限がかかるためスコアの操作に対して堅牢になります。

行列式の場合、NCDawareRankは以下のようにして計算されます。

$$
\hat{\pi} = O\eta\pi + M\mu\pi + E(1 - \eta - \mu)\pi,
$$

ただし

* $$0$$はアウトリンク行列
* $$M$$はレベル間近似度行列
* $$E$$はテレポーテーション行列
* $$\pi$$はNCDawareRank
* $$\eta$$はアウトリンク行列の寄与率
* $$\mu$$は近接アカウント(proximal account)の寄与率

を表します。

$$M$$と$$\mu$$が加えられたことを除けば、この定義はPageRankと同様です。
NEMの場合、$$\eta$$は0.7、$$\mu$$は0.1です。以下ではそれぞれの変数がいかにして計算されるかを説明します。

$$W$$を収穫に参加できる全アカウントの集合とします。$$u \in W$$に対し、$$G_u$$を、$$u$$へ送信した値よりも$$u$$から受け取った値の方が多いアカウントの集合とします。
$$W$$の部分集合で、お互いにほぼ完全に分離可能(Nearly completely decomposable, NCD)なものを$${A_1, A_2, ..., A_N}$$と定義します。ただし、任意の$$u \in W$$にたいして、$$u \in A_K$$となる$$K$$がただ一つだけ存在します。
したがって、$$u$$の近接アカウントの集合$$\chi_u$$は以下のように定義されます。

$$
\chi_u \triangleq \bigcup_{w \in (u \cup G_u)} A_{(w)}
$$

そして$$N_u$$を$$\chi_u$$に含まれるNCDブロックの数とします。

> 訳注: わかりにくいですが、PageRankにおいてリンクを貼ることを「投票」と
> 考えると、これは特定のアカウントではなく、そのアカウントの属するグループ
> 全体へと投票を「分散させる」ための手続きだと思ってください。$$\chi_u$$は
> 投票を受ける「政党」みたいなものです。

$$O$$の定義は[7.2: アウトリンク行列](/PoI/7.2.md)で述べたとおりです。収束を保証するために、$$O\eta + M\mu + E(1 - \eta - \mu)$$は既約で列ベクトルが確率分布としての条件を満たす(column-stochastic)行列でなくてはなりません。
この条件は、宙ぶらりんの(dongling)アカウント（外向きの辺が存在しないアカウント）に、0より大きい確率でテレポートするように、全アカウントに対する外向きの辺を持たせることで満たされます。

レベル間近似度行列$$M$$は、トランザクションのグラフをクラスタリング（詳細は[7.2説: トランザクショングラフのクラスタリング](/PoI/7.4.md)で述べます）し、各NCDブロック$$A_N$$を定義し、$$M$$の$$v,u$$要素である近接アカウントの近似度を以下のように定義することで求められます。

$$
M_{v,u} \triangleq \left\{ \begin{array}{ll} \frac{1}{N_v|A_{(v)}|} & (v \in \chi_u) \\ 0 & (otherwise) \end{array} \right.
$$

テレポーテーション行列$$E$$は以下で定義されます

$$
E \triangleq ev^T
$$

ただし$$v^T$$はテレポーテーション確率のベクトルで、$$e$$は全要素が1のベクトルです。

実用上は、NCDawareRankは以下のようにべき乗法によって求められます。

$$
\begin{aligned}
NCDawareRank^r(i) = (1-\eta-\mu)\frac{1}{|G|} \\
 + \eta\sum_{k=1}^{s}o_{ik}NCDawareRank^{r-1}(k) \\
 + \mu\sum_{k=1}^sm_{ik}NCDawareRank^{r-1}(k)

\end{aligned}
$$

ただし$$o_{ki}$$は$$O$$の$$k$$行$$i$$列目の要素を、$$m_{ki}$$は$$M$$における$$k$$行$$i$$列目の要素を指します。
このアルゴリズムは、イテレーション時のNCDawareRankの差分が所与の$$\varepsilon$$よりも小さくなった際、つまり以下が真になった際に収束します。

$$
\bigg(\sum_{i \in G}|NCDawareRank^r(i) - NCDawareRank^{r-1}(i)|\bigg) < \varepsilon
$$

アウトリンク行列とレベル間近似度行列に加え、テレポーテーションが起こることで、アカウント間の遷移確率行列が、確率分布としての条件を満たし既約で原始的(primitive)であることが保証されますので、上記のアルゴリズムの収束も保証されます。
PageRankの数学的理論についての詳細は[^9](/References.md#9)を参照してください。

[^10](/References.md#10)で述べられているように、スパースな行列である$$M$$を$$R$$と$$A$$という2つの行列に分解することで、計算量を減らしてNCDawareRankをより高速に求めることができます。$$A$$は

$$
A \triangleq
\left[
    \begin{array}{cccc}
        e_{|A_1|} & 0 & \cdots & 0 \\
        0 & e_{|A_2|} & \cdots & 0 \\
        \vdots & \vdots & \ddots & \vdots \\
        0 & 0 & \cdots & e_{|A_N|}
    \end{array}
\right]
$$

のように定義されます。ここで$$e_{A_k}$$は要素数$$|A_k|$$で、全ての要素が1であるベクトルです。

$$
c = (\frac{1}{|A_1|} \frac{1}{|A_2|} ... \frac{1}{|A_N|})
$$

$$
R \triangleq \bigg[c_1R_{1*}^{'} c_2R_{2*}^{'} ... c_NR_{N*}^{'} \bigg]
$$

ただし$$R_{i*}^{'}$$は、以下のように定義される行列$$R^{'}$$の$$i$$番目の行です。

$$
R_{ij} \triangleq
\left\{
    \begin{array}{ll}
        \frac{1}{N_u} & (A_i \in \chi_u) \\
        0 & (otherwise)
    \end{array}
\right.
$$

NEMの実装では$$M$$を$$A$$と$$R$$に分解しています。これが以下に時間、空間計算量を削減するかについては[^10](/References#10)で詳細な議論が行われています。
