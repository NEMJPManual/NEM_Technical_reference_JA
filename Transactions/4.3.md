## マルチシグ関連トランザクション

現時点で、NEMはn人の内m人（m of n）の署名が必要なマルチシグ（多重署名）アカウントをネイティブにサポートしています。

NEMのマルチシグトランザクションはフレキシビリティを念頭にデザインされています。
他のいかなるトランザクション（現時点では重要度委託トランザクション、送金トランザクション、マルチシグ変更トランザクション）
であろうともマルチシグトランザクションに変更できます。

### 4.3.1 マルチシグ変更トランザクション(Aggregate modification transaction)

これはmultisig modificationとも呼ばれ、以下の２種があります。

1. **マルチシグアカウントの作成**

マルチシグアカウントによって署名された、特別なマルチシグ変更トランザクションを送信することで、アカウントを**マルチシグ**アカウントへと変更することができます。
このトランザクションには連署人の情報が入っており、その数は最大で32です。

2. **マルチシグアカウントの設定変更**

マルチシグアカウントの作成後、マルチシグ変更トランザクション自体をマルチシグトランザクション化して送ることで、
連署人を追加したり削除したりすることができます。
一つのトランザクションにつき、変更できる連署人の数は一人づつです。

* 連署人を追加する際は、現時点での全ての連署人の署名が必要です。
* 連署人を削除する際は、削除対象者以外の全ての連署人のサインが必要です。

全連署人が削除された場合、アカウントは通常の非マルチシグアカウント戻ります。

マルチシグ変更トランザクションの手数料は以下です。

$$
fee = 10 + 6 * number of modifications
$$

ただし「modification」は連署人の追加・削除を指します。

### 4.3.2 マルチシグ署名トランザクション(Multisig signature transaction)

NEMは、連署人がマルチシグトランザクションに署名するために、マルチシグ署名トランザクションを使用します。
手数料は6 XEMで、連署人のアカウントではなくマルチシグアカウントから引き出されます。

マルチシグ署名トランザクションは、対応するマルチシグトランザクションがすでにブロックチェーンに含まれている時のみ、ブロックチェーンに取り込まれることができます。対応するものがなければ取り込まれません。

### 4.3.3 マルチシグトランザクション

前述のように、任意のトランザクションは、マルチシグトランザクションにラッピングすることができます。

マルチシグアカウントから別のアカウントにXEMを送信するには、送金トランザクションをラップする必要があります。
このラップによるマルチシグ化には追加で6XEMの手数料がかかります。

以下の例では、その際の更に詳細な手順を説明しています:
前提として、マルチシグアカウント$(M)$は1000XEMの残高と連署人$$(A,B,C)$$を持ち、そこから100XEMをアカウント$$X$$に送るとします。

どの連署人も、100XEMの送金を開始する権限を持ちます。Bが送金開始を提案し、A,Cがそれに連署するというケースを考えてみましょう。トランザクションが受理されるまでに以下の手順が発生します。

1. 「署名者」がマルチシグアカウントになっている以外は通常と変わらない、100XEMの送金トランザクションをBが作成する。
2. Bが署名されていない送金トランザクションをマルチシグトランザクションにラップする
3. Bはこのマルチシグトランザクションに署名し、NEMネットワークに送る。
4. 一時停止中のマルチシグトランザクションがあるという通知がA、Cに対して来る。
5. そのトランザクションに対して、Aはハッシュ値を計算し署名することで、マルチシグ署名トランザクションを作成し、ネットワークに送る。
6. Aと同様のことをCが行う。
7. 全連署人が署名を完了したので、トランザクションはネットワークに受理されMからXへ100XEMが送られる。

もしAまたはCのいずれかがマルチシグ送金トランザクションの〆切の前にマルチシグ署名トランザクションを送信しなかった場合、その送金トランザクションは無効と判断されネットワークから拒否されます。
$$M$$から$$X$$へのXEMの送金は行われません。



